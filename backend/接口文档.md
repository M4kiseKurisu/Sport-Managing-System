# 接口文档

## 一、用户相关

### 1.1 用户登录验证

请求 URL：`http://127.0.0.1:8000/api/user/login`

请求方式：`GET`

查询参数：

| 参数     | 说明               |
| -------- | ------------------ |
| account  | 账号、string、必需 |
| password | 密码、string、必需 |

```json
{
	"account": "manager",
    "password": "fyb123",
}
```

返回响应：

| 数据      | 说明              |
| --------- | ----------------- |
| msg       | 返回说明、string  |
| status    | 登录状态、boolean |
| uid       | 用户id、int       |
| user_name | 用户名、string    |

```json
{
    "msg": "登录成功",
    "status": true,
    "uid": 2135220,
    "user_name": "贴吧第一美男子"
}
```



### 1.2 用户注册

请求 URL：`http://127.0.0.1:8000/api/user/register`

请求方式：`POST`

请求参数（application/json）：

| 参数         | 说明                                  |
| ------------ | ------------------------------------- |
| account      | 账号、string、必选                    |
| password     | 密码、string、必选                    |
| user_name    | 用户名、string、必选                  |
| user_age     | 用户年龄、string、必选                |
| user_gender  | 用户性别、int、必选、0表示女，1表示男 |
| phone_number | 电话号码、int、必选                   |
| email        | 邮箱、string、必选                    |

```json
{
    "account": "manager",
    "password": "fyb123",
    "user_name": "贴吧第一美男子",
    "user_age": 10,
    "user_gender": 0,
    "phone_number": 12345678910,
    "email": "sb@outlook.com"
}
```

返回响应：

| 数据      | 说明              |
| --------- | ----------------- |
| msg       | 返回说明、string  |
| status    | 请求状态、boolean |
| uid       | 用户id、int       |
| user_name | 用户名、string    |

```json
{
    "msg": "注册成功",
    "status": true,
    "uid": 2135220,
    "user_name": "贴吧第一美男子"
}
```



### 1.3 查看个人基本信息

>说明：查看指定用户的基本信息。
>
>保证：用户的 uid 在数据库中。

请求 URL：`http://127.0.0.1:8000/api/user/information`

请求方式：`GET`

查询参数：

| 参数 | 说明              |
| ---- | ----------------- |
| uid  | 用户id、int、必选 |

```json
{
    "uid":  2135220
}
```

返回响应：

| 数据   | 说明                 |
| ------ | -------------------- |
| msg    | 返回说明、string     |
| status | 请求状态、boolean    |
| info   | 用户信息对象、object |

```json
{
    "msg": "个人基本信息获取成功",
    "status": true,
    "info": {
        "uid": "2135220",
        "name": "贴吧第一美男子",
        "age": 10,
        "gender": "女",
        "phone": 12345678910,
        "email": "sb@outlook.com",
        "signature": "抽象",
        "picture": null,
        "activity": 0,
        "friend": 0,
        "group": 2
    }
}
```



### 1.4 修改个人信息(ing 别用)

>说明：用户修改个人基本信息。
>
>保证：用户的 uid 在数据库中。
>
>错误：修改后的电话号码和邮箱重复。

请求 URL：`http://127.0.0.1:8000/api/user/modify/text`

请求方式：`POST`

请求参数（application/json）：

| 参数 | 说明                         |
| ---- | ---------------------------- |
| uid  | 用户id、int、必选            |
| data | 修改的信息对象、object、必选 |

data 是一个对象，其中包括修改的个人信息。

data 有如下属性**可选**（严格以此命名属性名）：

|     属性名     |        说明        |
| :------------: | :----------------: |
|   user_name    |   用户名、string   |
|    user_age    |     年龄、int      |
|  user_gender   | 性别、int (0女1男) |
|  phone_number  |   电话号码、int    |
|     email      |    邮箱、string    |
| user_signature |  个人签名、string  |

返回响应：

| 数据   | 说明              |
| ------ | ----------------- |
| msg    | 返回说明、string  |
| status | 请求状态、boolean |



### 1.5 查看用户所属团体

> 说明：查看指定用户所属的团体信息。
>
> 保证：用户的 uid 在数据库中。

请求 URL：`http://127.0.0.1:8000/api/user/group`

请求方式：`GET`

查询参数：

| 参数 | 说明              |
| ---- | ----------------- |
| uid  | 用户id、int、必选 |

```json
{
    "uid": 2135220
}
```

返回响应：

| 数据   | 说明                |
| ------ | ------------------- |
| msg    | 返回说明、string    |
| status | 请求状态、boolean   |
| list   | 团体信息数组、array |

```json
{
    "msg": "团体信息请求成功",
    "status": true,
    "list": [
        {
            "gid": 24103669,
            "group_name": "大运村",
            "pic": "/media/images/group/20231120155452_75.jpg",
            "type": "创建人"
        },
        {
            "gid": 63227680,
            "group_name": "buaa",
            "pic": null,
            "type": "创建人"
        }
    ]
}
```

<br>

## 二、团体相关

### 2.1 团体中心综述

请求 URL：`http://127.0.0.1:8000/api/group/view`

请求方式：`GET`

查询参数：

| 参数    | 说明                 |
| ------- | -------------------- |
| keyword | 关键字、string、可选 |
| uid     | 用户id、int、必选    |

```json
{
    "uid": 2135220,
    "keyword": "B"
}
```

返回响应：

| 数据   | 说明                |
| ------ | ------------------- |
| msg    | 返回说明、string    |
| status | 请求状态、boolean   |
| list   | 团体信息数组、array |

```json
{
    "msg": "团体信息请求成功",
    "status": true,
    "list": [
        {
            "gid": 63227680,
            "group_name": "buaa",
            "group_desc": "世界第一大专",
            "tag": "综合",
            "capacity": 1,
            "maximum": 50,
            "creator": "贴吧第一美男子",
            "is_joined": true,
            "pic": null
        }
    ]
}
```



### 2.2 用户创建团体

> 说明：用户创建团体。
>
> 保证：用户 uid 已经注册到数据库中。
>
> 错误：团体名称已经存在。

请求 URL：`http://127.0.0.1:8000/api/group/create`

请求方式：`POST`

请求参数（multipart/form-data）：

| 参数       | 说明                   |
| ---------- | ---------------------- |
| uid        | 用户id、int、必选      |
| group_name | 团体名、string、必选   |
| group_desc | 团体描述、string、必选 |
| maximum    | 人数上限、int、必选    |
| tag        | 团体标签、string、必选 |
| picture    | 团体图片、file、必选   |

```json
let data = new FormData();
data.append('uid', '2135220');
data.append('group_name', '大运村');
data.append('group_desc', '代孕村崛起');
data.append('maximum', '1000');
data.append('tag', '综合');
data.append('picture', fs.createReadStream('cmMtdXBsb2FkLTE3MDA0NjU1ODMxMTYtMg==/4602bbd3bd35e400.jpg'));
```

返回响应：

| 数据       | 说明              |
| ---------- | ----------------- |
| msg        | 返回说明、string  |
| status     | 请求状态、boolean |
| group_name | 团体名、string    |
| gid        | 团体id、int       |

```json
{
    "msg": "团体创建成功",
    "status": true,
    "group_name": "大运村",
    "gid": 24103669
}
```



### 2.3 用户申请加入团体

> 说明：用户申请加入指定团体。
>
> 保证：用户、团体均已经存在于数据库中；用户尚未加入到团体中。
>
> 错误：审核时段申请失败，团体人数已到达上限时失败。

请求 URL：`http://127.0.0.1:8000/api/group/join`

请求方式：`POST`

请求参数（application/json）：

| 参数    | 说明                   |
| ------- | ---------------------- |
| uid     | 用户id、int、必选      |
| gid     | 团体id、int、必选      |
| content | 申请信息、string、必选 |

```json
{
    "uid": 30359251,
    "gid": 63227680,
    "content": "我要上摆航"
}
```

返回响应：

| 数据   | 说明              |
| ------ | ----------------- |
| msg    | 返回说明、string  |
| status | 申请状态、boolean |

```json
{
    "msg": "申请信息已发送",
    "status": true
}
```



### 2.4 查看团体申请信息

> 说明：团体创建人、管理员查看团体的申请信息、用户查看已发送的团体申请信息。
>
> 保证：用户存在于数据库中

请求 URL：`http://127.0.0.1:8000/api/group/apply`

请求方式：`GET`

查询参数：

| 参数   | 说明                   |
| ------ | ---------------------- |
| uid    | 用户id、int、必选      |
| method | 申请类型、string、必选 |

method参数有两个选项：accept、send，分别表示查看受到团体申请和个人发送的团体申请。

```json
{
    "uid": 2135220,
    "method": "accept"
}

{
    "uid": 30359251,
    "method": "send"
}
```

返回响应：

| 数据 | 说明                |
| ---- | ------------------- |
| msg  | 返回说明、string    |
| list | 申请信息数组、array |

```json
// method: accept
{
  "msg": "团体申请获取成功",
  "status": true,
  "list": [
    {
      "uid": 30359251,
      "user_name": "小二",
      "content": "我要上摆航",
      "gid": 63227680,
      "group_name": "buaa",
      "time": "2023-11-20 17:02:08",
      "status": "申请中"
    }
  ]
}

// method: send
{
    "msg": "团体申请获取成功",
    "status": true,
    "list": [
        {
            "gid": 63227680,
            "group_name": "buaa",
            "content": "我要上摆航",
            "time": "2023-11-20 17:02:08",
            "status": "申请中"
        }
    ]
}
```



### 2.5 处理团体申请信息

请求 URL：`http://127.0.0.1:8000/api/group/apply`

请求方式：`POST`

请求参数（application/json）：

| 参数 | 说明                                             |
| ---- | ------------------------------------------------ |
| mid  | 管理员id、int、必选                              |
| uid  | 申请人id、int、必选                              |
| gid  | 团体id、int、必选                                |
| res  | 是否同意、boolean、必选、`true`同意，`false`拒绝 |

```json
{
    "mid": 123456,
    "uid": 10086,
    "gid": 87069784,
    "res": false
}
```

返回响应：

| 数据   | 说明             |
| ------ | ---------------- |
| msg    | 返回说明、string |
| status | 状态、boolean    |

```json
{
    "msg": "处理完成",
    "status": true
}
```

前端约束：

- 保证团体申请信息数据在数据库中


<br>

## 三、场地相关

### 3.1 新增场地信息（后端使用）

请求 URL：`http://127.0.0.1:8000/api/field/add`

请求方式：`POST`

请求参数（application/json）：

| 参数       | 说明                    |
| ---------- | ----------------------- |
| category   | 类别、string、必选      |
| location   | 位置、string、必选      |
| limit      | 场地限制、boolean、必选 |
| open_time  | 开始时间、time、必选    |
| close_time | 结束时间、time、必选    |

```json
{
    "category": "篮球场",
    "location": "运动场一号篮球场",
    "limit": true,
    "open_time": "06:00",
    "close_time": "22:00"
}
```

返回响应：

| 数据 | 说明             |
| ---- | ---------------- |
| msg  | 返回说明、string |

```json
{
    "msg": "场地信息添加成功"
}
```



### 3.2 查询场地信息

请求 URL：`http://127.0.0.1:8000/api/field/view`

请求方式：`GET`

查询参数：

| 参数     | 说明                   |
| -------- | ---------------------- |
| category | 场地类别、string、可选 |

```json
{
    "category": "篮球场"
}
```

返回响应：

- `category`为空时：

  | 数据 | 说明                  |
  | ---- | --------------------- |
  | msg  | 返回说明、string      |
  | list | 运动场类别数组、array |

  ```json
  {
      "msg": "场地信息请求成功",
      "list": [
          "篮球场",
          "排球场"
      ]
  }
  ```

- `category`非空时：

  | 数据 | 说明                    |
  | ---- | ----------------------- |
  | msg  | 返回说明、string        |
  | list | 场地详细信息数组、array |

  ```json
  {
      "msg": "场地信息请求成功",
      "list": [
          {
              "fid": 24406162,
              "location": "运动场二号篮球场",
              "open_time": "06:00:00",
              "close_time": "22:00:00"
          },
          {
              "fid": 69099027,
              "location": "运动场一号篮球场",
              "open_time": "06:00:00",
              "close_time": "22:00:00"
          }
      ]
  }
  ```



### 3.3 查看场地使用情况

请求 URL：`http://127.0.0.1:8000/api/field/usage`

请求方式：`GET`

查询参数：






<br>

## 四、活动相关





<br>

## 五、器材相关

### 5.1 添加器材信息

请求 URL：`http://127.0.0.1:8000/api/equipment/add`

请求方式：`POST`

请求参数（multipart/form-data）：

| 参数     | 说明               |
| -------- | ------------------ |
| category | 类别、string、必选 |
| amount   | 数量、int、必选    |
| picture  | 图片、file、必选   |

```js
let formdata = new FormData();
formdata.append("picture", fileInput.files[0], "basketball.jpg");
formdata.append("category", "篮球");
formdata.append("amount", "20");
```

返回响应：

| 数据   | 说明              |
| ------ | ----------------- |
| msg    | 返回说明、string  |
| status | 请求状态、boolean |

```json
{
    "msg": "器材信息添加成功",
    "status": true
}
```



### 5.2 查看器材信息

请求 URL：`http://127.0.0.1:8000/api/equipment/view`

请求方式：`GET`

查询参数：

| 参数    | 说明                         |
| ------- | ---------------------------- |
| keyword | 器材类别关键字、string、可选 |

```json
{
    "keyword": "球"
}
```

返回响应：

| 数据   | 说明                |
| ------ | ------------------- |
| msg    | 返回说明、string    |
| status | 请求状态、boolean   |
| list   | 器材信息数组、array |

  ```json
  {
      "msg": "器材信息请求成功",
      "status": true,
      "list": [
          {
              "eid": 78184649,
              "category": "篮球",
              "amount": 20,
              "pic": "/media/images/equipment/20231118170904_73.png"
          },
          {
              "eid": 95298768,
              "category": "乒乓球",
              "amount": 60,
              "pic": "/media/images/equipment/20231118171341_91.png"
          }
      ]
  }
  ```



### 5.3 借用器材

> 说明：申请借用器材，分为团体借用和个人借用两种。对于团体借用，要求用户必须为该团体的创建人或管理员。
>
> 保证：用户存在、团体存在、借用器材类别存在。
>
> 错误：当借用的数量大于剩余数量时借用失败。同一时段内借用同种器材时借用失败。

请求 URL：`http://127.0.0.1:8000/api/equipment/borrow`

请求方式：`POST`

请求参数（application/json）：

| 参数       | 说明                                            |
| ---------- | ----------------------------------------------- |
| gid        | 团体id、int、可选                               |
| uid        | 用户id、int、可选                               |
| category   | 类别、string、必选                              |
| amount     | 数量、int、必选                                 |
| start_time | 借用开始时间、string("%Y-%m-%d %H:%M:%S")、必选 |
| end_time   | 借用结束时间，string("%Y-%m-%d %H:%M:%S")、必选 |

gid、uid 参数二选一，分别表示团体借用器材和用户借用器材两种情况。

```json
{
    "gid": 63227680,
    "category": "排球",
    "amount": 2,
    "start_time": "2023-12-12 13:00:00",
    "end_time": "2023-12-12 15:30:00"
}
```

```json
{
    "uid": 2135220,
    "category": "篮球",
    "amount": 1,
    "start_time": "2023-12-12 19:00:00",
    "end_time": "2023-12-12 20:20:00"
}
```

返回响应：

| 数据   | 说明              |
| ------ | ----------------- |
| msg    | 返回说明、string  |
| status | 请求状态、boolean |

```json
{
    "msg": "器材借用成功",
    "status": true
}
```



### 5.4 查看器材借用记录

> 说明：查看器材借用的记录，共有已归还、未归还两种。对于团体的借用记录，所有成员都可见。
>
> 保证：查询参数中用到的所有实体都存在于数据库中。

请求 URL：`http://127.0.0.1:8000/api/equipment/record`

请求方式：`GET`

查询参数：

| 参数   | 说明                           |
| ------ | ------------------------------ |
| uid    | 用户id、int、必选              |
| config | 查询附加信息对象、object、必选 |

config 配置对象有如下属性：

|    属性    |  类型  |                     说明                     | 选择 |
| :--------: | :----: | :------------------------------------------: | :--: |
|   method   | string |     查询的类型、`person`，`group` 二选一     | 必选 |
| group_name | string | 团体名**关键字**，只能在`method=group`时使用 | 可选 |
|  category  | string |            借用器材类型**关键字**            | 可选 |
|    time    | string |            借用时间 ("%Y-%m-%d“)             | 可选 |
|   state    |  int   |        器材归还情况(0未归还、2已归还)        | 可选 |

```json
{
    "uid": 2135220,
    "config": {
        "method": "person"
    }
}

{
    "uid": 2135220,
    "config": {
        "method": "group"
    }
}
```

返回响应：

| 数据   | 说明              |
| ------ | ----------------- |
| msg    | 返回说明、string  |
| status | 请求状态、boolean |
| list   | 器材借用情况数组  |

```json 
// person
{
    "msg": "器材借用记录获取成功",
    "status": true,
    "list": [
        {
            "pic": "/media/images/equipment/20231118170904_73.png",
            "category": "篮球",
            "lend_amount": 1,
            "start_time": "2023-12-12 19:00:00",
            "end_time": "2023-12-12 20:20:00",
            "is_return": "已归还"
        }
    ]
}

// group
{
    "msg": "器材借用记录获取成功",
    "status": true,
    "list": [
        {
            "gid": 63227680,
            "group_name": "buaa",
            "pic": "/media/images/equipment/20231118171542_60.png",
            "category": "排球",
            "lend_amount": 2,
            "start_time": "2023-12-12 13:00:00",
            "end_time": "2023-12-12 15:30:00",
            "is_return": "未归还"
        }
    ]
}
```



### 5.5 归还器材

> 说明：归还器材，其中团体允许其任何成员归还器材。
>
> 保证：用户存在、团体存在、器材存在；存在借用记录，且尚未归还。

请求 URL：`http://127.0.0.1:8000/api/equipment/return`

请求方式：`POST`

请求参数（application/json）：

| 参数       | 说明                                            |
| ---------- | ----------------------------------------------- |
| gid        | 团体id、int、可选                               |
| uid        | 用户id、int、可选                               |
| eid        | 器材id、int、必选                               |
| start_time | 借用开始时间、string("%Y-%m-%d %H:%M:%S")、必选 |
| end_time   | 借用结束时间、string("%Y-%m-%d %H:%M:%S")、必选 |

gid、uid 参数二选一，分别表示团体借用器材和用户借用器材两种情况。

```json
{
    "uid": 2135220,
    "eid": 78184649,
    "category": "篮球",
    "start_time": "2023-12-12 19:00:00",
    "end_time": "2023-12-12 20:20:00"
}
```

返回响应：

| 数据   | 说明              |
| ------ | ----------------- |
| msg    | 返回说明、string  |
| status | 请求状态、boolean |

```json
{
    "msg": "器材归还成功", 
    "status": true
}
```
