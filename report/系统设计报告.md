# 系统设计报告

## 一、需求分析

### 1.1 需求描述

作为在北航生活三年的学生，我们对北航的生活基本满意，但是认为在课余的运动生活中会遇到一些困难。这些困难包括：想要运动时，却发现没有场地可供使用、很多场地甚至被校外人士和小学、初中生占用；课余活动比较缺乏，很难组织或参加一些人数较多的活动；由于宿舍空间普遍较小、学业任务较重，自己购入一些运动的装备性价比低且难以完好保存；平时学习时间较多，因此难以花费时间社交，就难以聚拢和自己喜欢同样活动的志同道合的友人，也没办法有组织的组织周常、月常举行的活动等等。

针对这些需求，我们设计了一款能够满足以上北航学生诉求的网站。本网站的目标是满足北航学生在课余生活中进行体育运动，社交活动的需求，其具体功能包括：

1. 申请、加入、评价活动：

本网站允许同学们以个人或者团体的名义（这需要同学是团体中的管理员或创建者）申请举办活动，同时活动具有类型和一些标签，方便其他同学根据自己的兴趣来选择性的搜索活动，加入活动。本网站也会提供一些计算出的，认为用户会感兴趣的推荐活动，让用户进行选择。用户还可以自由查看之前举办的精彩活动和自己参加过、将要参加的全部活动并进行点赞评价。

2. 创建、加入团体：

本网站允许同学们创建团体，用来形成互相联络，共同组织和参加活动的同学圈子。创建团体同样可以为团体添加简介来对其进行介绍。同时，同学们可以查看到当前创建的所有团体的简介情况、以该团体为单位申请的活动情况和团体中的成员情况。如果同学对某一团体感兴趣，则可以填写一定信息申请加入该团体。同学的申请会被该团体的管理员审核，若通过，同学就可以顺利进入团体。同时在任何时候同学都可以自由的退出某一团体，管理员也可以解散其团体。

3. 申请场地：

无论在以个人还是团体名义申请活动时，都需要选择其举办的场地。我们将场地进行了分类（例如操场、篮球场等），方便用户进行查询。用户可以自由查看某一场地在任意一天的借用情况。只要保证申请的活动期间本场地没有被其他活动借用，就可以成功申请在活动时间内使用该场地。

4. 申请器材：

用户可以自由看到当前能够申请的所有器材种类和剩余数目，并可以进行自由借用。对器材的申请同样可以选择以个人或团体的名义，以团体名义申请同样要求申请者是该团体的管理员或创建者。只需要填写借用的时间和保证剩余数目能够满足借用需求即可。同时用户也能自由查看自己的借用记录，包括已经归还的、正在使用的和归还超限的借用情况。要注意，在借用时限内进行归还是可以在线上进行操作的，而逾期未归还的器材只能通过线下方式归还。

5. 个人信息和好友系统：

所有用户都拥有个人信息界面，可以查看诸如自己当前已经参加的活动数目、所属的团体数目等等信息，网站还会提供一些过往用户使用此网站的数据情况，例如参加的活动种类饼状图等。同时允许用户根据用户名搜索其他用户并添加好友，一旦添加好友就可以查看该好友的个人信息情况。同时本网站还实现了类似朋友圈的功能，让用户可以针对一些自己参加的活动发布个人感受，同时这些感受也对其好友开放，即用户也可以查看其好友对其参加的一些活动发布的感受。

### 1.2 数据流图

**总体数据流图**

<div align="center">   
<img src="images\总体数据流图.drawio.png" width = "600" height = "" alt="图片名称" align=center />   
<div align="center">

**用户部分数据流图**

<div align="center">   
<img src="images\用户部分数据流图.drawio.png" width = "600" height = "" alt="图片名称" align=center />   
<div align="left">

**团体部分数据流图**

<div align="center">   
<img src="images\团体部分数据流图.drawio.png" width = "600" height = "" alt="图片名称" align=center />   
<div align="left">

**活动部分数据流图**

<div align="center">   
<img src="images\活动部分数据流图.drawio.png" width = "600" height = "" alt="图片名称" align=center />   
<div align="left">

**器材部分数据流图**

<div align="center">   
<img src="images\器材部分数据流图.drawio.png" width = "600" height = "" alt="图片名称" align=center />   
<div align="left">

**好友部分数据流图**

<div align="center">   
<img src="images\好友部分数据流图.drawio.png" width = "600" height = "" alt="图片名称" align=center />   
<div align="left">

**通知部分数据流图**

<div align="center">   
<img src="images\通知数据流图.drawio.png" width = "600" height = "" alt="图片名称" align=center />   
<div align="left">

**动态部分数据流图**

<div align="center">   
<img src="images\动态数据流图.drawio.png" width = "600" height = "" alt="图片名称" align=center />   
<div align="left">

### 1.3 数据元素表

#### 1.3.1 用户信息管理部分

**用户表**

|  属性名  |     字段名     | 数据类型 | 数据宽度 | 允许空值 | 备注  |
| :------: | :------------: | :------: | :------: | :------: | :---: |
|  用户ID  |      uid       |   int    |    32    |    否    | 主键  |
|   账号   |    account     | varchar  |    32    |    否    |       |
|   密码   |    password    | varchar  |    32    |    否    |       |
|   姓名   |   user_name    | varchar  |    10    |    否    |       |
|   性别   |  user_gender   | tinyint  |    8     |    否    |       |
|   年龄   |    user_age    |   int    |    32    |    否    |       |
| 个人签名 | user_signature | varchar  |   128    |    是    |       |
| 电话号码 |  phone_number  | varchar  |    16    |    否    |       |
|   邮箱   |     email      | varchar  |    32    |    否    |       |

**系统通知表**

|   属性名   |  字段名  | 数据类型 | 数据宽度 | 允许空值 | 备注  |
| :--------: | :------: | :------: | :------: | :------: | :---: |
|   通知ID   |   nid    |   int    |    32    |    否    | 主键  |
|  通知时间  |   time   | datetime |          |    否    |       |
|  通知内容  |   text   | varchar  |   256    |    否    |       |
| 通知对象ID | receiver |   int    |    32    |    否    | 外键  |

#### 1.3.2 团体组织管理部分

**团体表**

|  属性名  |   字段名   | 数据类型 | 数据宽度 | 允许空值 | 备注  |
| :------: | :--------: | :------: | :------: | :------: | :---: |
|  团体ID  |    gid     |   int    |    32    |    否    | 主键  |
|   名称   | group_name | varchar  |    32    |    否    |       |
|   描述   | group_desc | varchar  |   128    |    否    |       |
| 人数限制 |  maximum   |   int    |    32    |    否    |       |
| 成员人数 |  capacity  |   int    |    32    |    否    |       |
|   标签   |    tag     | varchar  |    32    |    否    |       |
|  创建人  |  creator   |   int    |    32    |    否    | 外键  |

**团体成员表**

|  属性名  | 字段名 | 数据类型 | 数据宽度 | 允许空值 |    备注    |
| :------: | :----: | :------: | :------: | :------: | :--------: |
|  用户ID  |  uid   |   int    |    32    |    否    | 主键、外键 |
|  团体ID  |  gid   |   int    |    32    |    否    | 主键、外键 |
| 成员类型 |  type  | tinyint  |    8     |    否    |            |

**团体申请信息表**

|  属性名  |   字段名   | 数据类型 | 数据宽度 | 允许空值 |    备注    |
| :------: | :--------: | :------: | :------: | :------: | :--------: |
|  用户ID  |    uid     |   int    |    32    |    否    | 主键、外键 |
|  团体ID  |    gid     |   int    |    32    |    否    | 主键、外键 |
| 申请内容 |  content   | varchar  |   256    |    否    |            |
| 申请时间 | apply_time | datetime |          |    否    |    主键    |
| 申请状态 |   status   | boolean  |    8     |    否    |            |

#### 1.3.3 活动部分

**场地表**

|  属性名  |   字段名   | 数据类型 | 数据宽度 | 允许空值 | 备注  |
| :------: | :--------: | :------: | :------: | :------: | :---: |
|  场地ID  |    fid     |   int    |    32    |    否    | 主键  |
|   位置   |  location  | varcahr  |    32    |    否    |       |
|   类别   |  category  | varchar  |    32    |    否    |       |
| 开始时间 | open_time  |   time   |          |    否    |       |
| 结束时间 | close_time |   time   |          |    否    |       |
| 项目限制 |   limit    | boolean  |    8     |    否    |       |

**活动表**

|    属性名    |    字段名    | 数据类型 | 数据宽度 | 允许空值 | 备注  |
| :----------: | :----------: | :------: | :------: | :------: | :---: |
|    活动ID    |     aid      |   int    |    32    |    否    | 主键  |
|   活动名称   |     name     | varchar  |    32    |    否    |       |
|   活动描述   |     desc     | varchar  |   256    |    否    |       |
| 活动人数限制 |   maximum    |   int    |    32    |    否    |       |
|   参与人数   |   capacity   |   int    |    32    |    否    |       |
|   活动类型   |   category   | varcahr  |    32    |    否    |       |
|     标签     |     tags     | varchar  |   128    |    是    |       |
|  创建者类型  | creator_type | tinyint  |    8     |    否    |       |
|    获赞数    |    favor     |   int    |    32    |    否    |       |
|    私有性    |   private    | boolean  |    8     |    否    |       |
|   起始时间   |  start_time  | datetime |          |    否    |       |
|   结束时间   |   end_time   | datetime |          |    否    |       |
|     场地     |     fid      |   int    |    32    |    否    | 外键  |

**活动成员表**

|  属性名  | 字段名 | 数据类型 | 数据宽度 | 允许空值 |    备注    |
| :------: | :----: | :------: | :------: | :------: | :--------: |
|  用户ID  |  uid   |   int    |    32    |    否    | 主键、外键 |
|  活动ID  |  aid   |   int    |    32    |    否    | 主键、外键 |
| 参加时间 |  time  | datetime |          |    否    |            |
| 是否喜欢 |  like  | tinyint  |    8     |    否    |            |

#### 1.3.4 器材借用部分

**器材表**

| 属性名 |  字段名  | 数据类型 | 数据宽度 | 允许空值 | 备注  |
| :----: | :------: | :------: | :------: | :------: | :---: |
| 器材ID |   eid    |   int    |    32    |    否    | 主键  |
|  类别  | category | varchar  |    32    |    否    |       |
|  数量  |  amount  |   int    |    32    |    否    |       |

**用户器材借用记录**

|    属性名    |   字段名    | 数据类型 | 数据宽度 | 允许空值 |    备注    |
| :----------: | :---------: | :------: | :------: | :------: | :--------: |
|    器材ID    |     eid     |   int    |    32    |    否    | 主键、外键 |
|    用户ID    |     uid     |   int    |    32    |    否    | 主键、外键 |
| 借用开始时间 | start_time  | datetime |          |    否    |    主键    |
| 借用结束时间 |  end_time   | datetime |          |    否    |    主键    |
|   是否归还   |  is_return  | boolean  |    8     |    否    |            |
|   借用数量   | lend_amount |   int    |    32    |    否    |            |

**团体器材借用记录**

|    属性名    |   字段名    | 数据类型 | 数据宽度 | 允许空值 |    备注    |
| :----------: | :---------: | :------: | :------: | :------: | :--------: |
|    器材ID    |     eid     |   int    |    32    |    否    | 主键、外键 |
|    团体ID    |     gid     |   int    |    32    |    否    | 主键、外键 |
| 借用开始时间 | start_time  | datetime |          |    否    |    主键    |
| 借用结束时间 |  end_time   | datetime |          |    否    |    主键    |
|   是否归还   |  is_return  | boolean  |    8     |    否    |            |
|   借用数量   | lend_amount |   int    |    32    |    否    |            |

#### 1.3.5 社交分享部分

**好友表**

|  属性名  | 字段名 | 数据类型 | 数据宽度 | 允许空值 |    备注    |
| :------: | :----: | :------: | :------: | :------: | :--------: |
|  用户1   |  uid1  |   int    |    32    |    否    | 主键、外键 |
|  用户2   |  uid2  |   int    |    32    |    否    | 主键、外键 |
| 添加时间 |  time  | datetime |          |    否    |            |

**好友申请表**

|  属性名  |   字段名   | 数据类型 | 数据宽度 | 允许空值 |    备注    |
| :------: | :--------: | :------: | :------: | :------: | :--------: |
| 申请者ID |   sender   |   int    |    32    |    否    | 主键、外键 |
| 接收者ID |  receiver  |   int    |    32    |    否    | 主键、外键 |
| 申请内容 |  content   | varchar  |   128    |    是    |            |
| 申请时间 | apply_time | datetime |          |    否    |    主键    |
| 申请状态 |   state    | tinyint  |    8     |    否    |            |

**个人动态表**

|  属性名  |  字段名  | 数据类型 | 数据宽度 | 允许空值 | 备注  |
| :------: | :------: | :------: | :------: | :------: | :---: |
|  动态ID  |   sid    |   int    |    32    |    否    | 主键  |
| 发布时间 |   time   | datetime |          |    否    |       |
| 发布文本 |   text   | varchar  |   512    |    否    |       |
|  获赞数  |  favor   |   int    |    32    |    否    |       |
|  私有性  | private  | tinyint  |    8     |    否    |       |
| 所属用户 |   user   |   int    |    32    |    否    | 外键  |
| 关联活动 | activity |   int    |    32    |    否    | 外键  |

#### 1.3.6 其他部分

**图片表**

| 属性名  | 字段名 | 数据类型 | 数据宽度 | 允许空值 | 备注  |
| :-----: | :----: | :------: | :------: | :------: | :---: |
| 图片ID  |  pid   |   int    |    32    |    否    | 主键  |
| 图片url |  url   | varchar  |    64    |    否    |       |

<br>

## 二、数据库概念模式设计

### 2.1 系统分 `ER`图

- **用户信息管理部分**

<div align="center">   
<img src="images\用户信息管理部分ER图.drawio.png" width = "600" height = "" alt="图片名称" align=center />   
<div align="left">

- **团体组织管理部分**

<div align="center">   
<img src="images\团体组织管理部分ER图.drawio.png" width = "600" height = "" alt="图片名称" align=center />   
<div align="left">

- **社交分享部分**

<div align="center">   
<img src="images\社交分享ER图.drawio.png" width = "600" height = "" alt="图片名称" align=center />   
<div align="left">

- **器材借用部分**

<div align="center">   
<img src="images\器材借用ER图.drawio.png" width = "600" height = "" alt="图片名称" align=center />   
<div align="left">

- **活动部分**

<div align="center">   
<img src="images\活动部分ER图.drawio.png" width = "600" height = "" alt="图片名称" align=center />   
<div align="left">

- **其他部分**

<div align="center">   
<img src="images\其他部分ER图.drawio.png" width = "600" height = "" alt="图片名称" align=center />   
<div align="left">

### 2.2 系统初步 `ER`图

<div align="center">   
<img src="images\系统初步ER图.drawio.png" width = "800" height = "" alt="图片名称" align=center />   
<div align="left">

### 2.3 系统基本 `ER`图

在实现过程中，图片和用户、团体、器材和活动都是一对一关系，因此将图片下降为这四个实体的属性。

消除冗余后的基本E-R 图如下（已经略去属性，详见分E-R 图）

<div align="center">   
<img src="images\系统基本ER图.drawio.png" width = "800" height = "" alt="图片名称" align=center />   
<div align="left">

<br>

## 三、数据库逻辑模式设计

### 3.1 数据库关系模式

数据库关系可以形式化地表示为：R(U, D, DOM, F)，这其中 R 是关系名，U 是组成该关系的属性名集合，D 是 U 中属性所来自的域，DOM 是属性系向域的映像集合，F 是属性间数据的依赖关系的集合。

关系模式可以简记为 R(U)，域名及属性向域的映象常常直接说明为属性的类型、长度。

**由上述 E-R 图可以设计得到如下的关系模式：**

#### 3.1.1 实体

- **用户**

  user({ 用户ID、账号、密码、姓名、性别、年龄、个人签名、电话号码、邮箱、头像 })

  用户ID(int)、账号(varchar)、密码(varchar)、姓名(varchar)、性别(tinyint)、年龄(int)、个人签名(varchar)、电话号码(bigint)、邮箱(varchar)、头像(varchar)

  F={ 用户ID→(账号, 密码, 姓名, 性别, 年龄, 个人签名, 电话号码, 邮箱)、账号→用户ID、电话号码→用户ID、邮箱→用户ID }
- **团体**

  group({ 团体ID、名称、描述、团体图片、人数限制、成员人数、标签、创建人 })

  团体ID(int)、名称(varchar)、描述(varchar)、团体图片(varchar)、人数限制(int)、成员人数(int)、标签(varchar)、创建人(int)

  F={ 团体ID→(名称、描述、团体图片、人数限制、成员人数、标签、创建人)、名称→团体ID }
- **场地**

  field({ 场地ID、位置、类别、开放开始时间、开放结束时间、项目限制 })

  场地ID(int)、位置(varchar)、类别(varchar)、开放开始时间(datetime)、开发结束时间(datetime)、项目限制(tinyint)

  F={ 场地ID→(位置, 类别, 开放开始时间、开发结束时间、项目限制)、位置→ID }
- **活动**

  project({ 活动ID、活动名称、项目描述、活动图片、活动人数限制、参与人数、活动类型、标签、创建者类型、获赞数、私有性 })

  活动ID(int)、活动名称(varchar)、项目描述(varchar)、活动图片(varchar)、活动人数限制(int)、参与人数(int)、活动类型(varchar)、标签(varchar)、创建者类型(tinyint)、获赞数(int)、私有性(tinyint)

  F={ 活动ID→(活动名称、项目描述、活动图片、活动人数限制、参与人数、活动类型、标签、创建者类型、获赞数、私有性) }
- **器材**

  equipment({ 器材ID、器材类别、数量、图片 })

  器材ID(int)、类别(varchar)、数量(int)、图片(varchar)

  F={ 器材ID→类别、类别→器材ID、器材ID→数量、器材ID→图片 }
- **用户动态**

  stream({ 动态ID、发布时间、发布文本、发布图片、获赞数量、私有性、所属用户、关联活动 })

  动态ID(int)、发布时间(datetime)、发布文本(varchar)、发布图片(varchar)、获赞数量(int)、私有性(tinyint)、所属用户(int)、关联活动(int)

  F={ 动态ID→(发布时间, 发布文本, 发布图片, 获赞数量, 私有性, 所属用户, 关联活动)、(所属用户, 发布时间)→动态ID }
- **通知**

  notice({ 通知ID、通知时间、通知内容、通知对象 })

  通知ID(int)、通知时间(datetime)、通知内容(varchar)、通知对象(int)

  F={ 通知ID→(通知时间、通知内容、通知对象) }

#### 3.1.2 联系

- **用户参加活动**

  user_in_activity({ 用户ID、活动ID、是否喜欢 })

  用户ID是关联用户表的外键、活动ID是关联活动表的外键、是否喜欢(tinyint)

  F={ (用户ID, 活动ID)→(用户ID, 活动ID, 是否喜欢) }
- **用户创建活动**

  user_create_activity({ 用户ID、活动ID })

  用户ID是关联用户表的外键、活动ID是关联活动表的外键

  F={ 活动ID→用户ID }
- **团体创建活动**

  group_create_activity({ 团体ID、活动ID、创建人ID })

  团体ID是关联团体表的外键、活动ID是关联活动表的外键、创建人ID是关联用户表的外键

  F={ 活动ID→(团体ID, 创建人ID) }
- **活动-场地**

  activity_field({ 活动ID、场地ID、起始时间、结束时间 })

  活动ID是关联活动表的外键、场地ID是关联场地表的外键、起始时间(datetime)、结束时间(datetime)

  F={ 活动ID→(场地ID, 起始时间, 结束时间)、(场地ID, 起始时间)→活动ID、(场地ID, 结束时间)→活动ID }
- **用户从属团体**

  user_in_group({ 用户ID、团体ID、成员类型 })

  用户ID是关联用户表的外键、团体ID是关联团体表的外键、成员类型(tinyint)

  F={ (用户ID, 团体ID)→成员类型 }
- **用户申请团体**

  user_apply_group({ 用户ID、团体ID、申请内容、申请时间、申请状态 })

  用户ID是关联用户表的外键、团体ID是关联团体表的外键、申请内容(varchar)、申请时间(datetime)、申请状态(tinyint)

  F={ (用户ID, 团体ID, 申请时间)→(申请内容, 申请状态) }
- **好友**

  friend({ 用户ID1、用户ID2 })

  用户ID1、ID2是关联用户表的外键

  F={ (用户ID1, 用户ID2)→(用户ID1, 用户ID2) }
- **好友申请**

  friend_apply({ 申请者ID、接收者ID、申请内容、申请时间、申请状态 })

  申请者ID、接收者ID是关联用户表的外键、申请内容(varchar)、申请时间(datetime)、申请状态(tinyint)

  F={ (申请者ID, 接收者ID, 申请时间)→(申请内容、申请状态) }
- **个人借用器材**

  user_equipment({ 用户ID、器材ID、借用开始时间、借用结束时间、归还状态、借用数量 })

  用户ID是关联用户表的外键、器材ID是关联器材表的外键、借用开始时间(datetime)、借用结束时间(datetime)、归还状态(tinyint)、借用数量(int)

  F={ (用户ID, 器材ID, 借用开始时间、借用结束时间)→(归还状态, 借用数量) }
- **团体借用器材**

  group_equipment({ 团体ID、器材ID、借用开始时间、借用结束时间、归还状态、借用数量 })

  团体ID是关联团体表的外键、器材ID是关联器材表的外键、借用开始时间(datetime)、借用结束时间(datetime)、归还状态(tinyint)、借用数量(int)

  F={ (团体ID, 器材ID, 借用开始时间, 借用结束时间)→(归还状态, 借用数量) }
- **用户点赞动态记录**

  user_favor_stream({ 用户ID、动态ID })

  用户ID是关联用户表的外键，动态ID是关联动态表的外键

  F={ (用户ID, 动态ID)→(用户ID, 动态ID) }

### 3.2 关系模式范式等级的判定与规范化

#### 3.2.1 实体

- **用户**

  user({ 账号、密码、用户ID、姓名、性别、个人签名、电话号码、邮箱 })

  F={ 用户ID→(账号, 密码, 姓名, 性别, 个人签名, 电话号码, 邮箱)、账号→用户ID、电话号码→用户ID、邮箱→用户ID }

  用户表中，主码为用户ID，候选码为账号、电话号码和邮箱。因为所有的函数依赖的左部都是码（主码或候选码），所以用户表满足BCNF，并且也满足3NF。
- **团体**

  group({ 团体ID、名称、描述、团体图片、人数限制、成员人数、标签、创建人 })

  F={ 团体ID→(名称、描述、团体图片、人数限制、成员人数、标签、创建人)、名称→团体ID }

  团体表中，主码为团体ID，候选码为团体名称。因为所有的函数依赖的左部都是码（主码或候选码），所以团体表满足BCNF，也满足3NF。
- **场地**

  field({ 场地ID、位置、类别、开放开始时间、开放结束时间、项目限制 })

  F={ 场地ID→(位置, 类别, 开放开始时间、开发结束时间、项目限制)、位置→ID }

  场地表中主码为场地ID，候选码为位置，所有函数依赖左端都为码，因此场地表 ∈ BCNF，场地表 ∈ 3NF。
- **活动**

  activity({ 活动ID、活动名称、项目描述、活动图片、活动人数限制、参与人数、活动类型、标签、创建者类型、获赞数、私有性 })

  F={ 活动ID→(活动名称、项目描述、活动图片、活动人数限制、参与人数、活动类型、标签、创建者类型、获赞数、私有性) }

  活动表中的函数依赖左部均为活动ID(主键)，因此属于 BCNF，也就属于 3NF。
- **器材**

  equipment({ 器材ID、器材类别、数量、图片 })

  F={ 器材ID→类别、类别→器材ID、器材ID→数量、器材ID→图片 }

  器材表主码为器材ID，候选码为器材类别，所有函数依赖左端都为码，因此器材表 ∈ BCNF，器材表 ∈ 3NF。
- **通知**

  notice({ 通知ID、通知时间、通知内容、通知对象 })

  F={ 通知ID→(通知时间、通知内容、通知对象) }

  通知表的主码是通知ID，所有函数依赖左端都是码，因此通知表 ∈ BCNF，通知表 ∈ 3NF。
- **用户动态**

  stream({ 动态ID、发布时间、发布文本、发布图片、获赞数量、私有性、所属用户、关联活动 })

  F={ 动态ID→(发布时间、发布文本、发布图片、获赞数量、私有性、所属用户、关联活动)、(所属用户、发布时间)→动态ID }

  动态表主码为动态ID，候选码为是用户ID和发布时间的组合，所有函数依赖左端都为码，因此动态表 ∈ BCNF，动态表 ∈ 3NF。

#### 3.2.2 联系

- **用户参加活动**

  user_in_activity({ 用户ID、活动ID、喜欢 })

  F={ (用户ID, 活动ID)→(用户ID, 活动ID, 喜欢) }

  用户参加活动表所有属性都是主属性且共同组成主码，因此用户参加活动表 ∈ BCNF，用户参加活动表 ∈ 3NF。
- **用户创建活动**

  user_create_activity({ 用户ID、活动ID })

  F={ 活动ID→用户ID }

  用户创建活动表中，主码是活动ID，对于每个函数依赖左部都包含码，所以用户创建活动表 ∈ BCNF，用户创建活动表 ∈ 3NF。
- **团体创建活动**

  group_create_activity({ 团体ID、活动ID、创建人ID })

  F={ 活动ID→(团体ID, 创建人ID) }

  团体创建活动表的主码是活动ID，函数依赖左部都是码，因此该表属于 BCNF，属于 3NF。
- **活动-场地**

  activity_field({ 活动ID、场地ID、起始时间、结束时间 })

  F={ 活动ID→(场地ID, 起始时间, 结束时间)、(场地ID, 起始时间)→活动ID、(场地ID, 结束时间)→活动ID }

  活动-场地表中活动ID为主码，候选码分别有 (场地ID, 起始时间) 和 (场地ID, 结束时间)，对于每个函数依赖其左部都包含码，因此活动-场地表 ∈ BCNF，活动-场地表 ∈ 3NF。
- **用户从属团体**

  user_in_group({ 用户ID、团体ID、成员类型 })

  F={ (用户ID, 团体ID)→成员类型 }

  本表中主码为用户ID，团体ID组成的属性集，每个函数依赖左部都包含码，因此用户从属团体表 ∈ BCNF，同时用户从属团体表 ∈ 3NF。
- **用户申请团体**

  user_apply_group({ 用户ID、团体ID、申请内容、申请时间、申请状态 })

  F={ (用户ID, 团体ID, 申请时间)→(申请内容, 申请状态) }

  本表中主码为用户ID，团体ID和申请时间的属性组，对于每个函数依赖左部都包含码，因此用户申请团体表 ∈ BCNF，用户申请团体表 ∈ 3NF。
- **好友**

  friend({ 用户ID1、用户ID2 })

  F={ (用户ID1, 用户ID2)→(用户ID1, 用户ID2) }

  好友表中所有属性都是主属性且共同组成主码，因此好友表 ∈ BCNF，好友表 ∈ 3NF。
- **好友申请**

  friend_apply({ 申请者ID、接收者ID、申请内容、申请时间、申请状态 })

  F={ (申请者ID、接收者ID、申请时间)→(申请内容、申请状态) }

  好友申请表中主码是申请者ID、接受者ID、申请时间组成的属性组，所有函数依赖左部都包含码，因此好友申请表属于 BCNF，同时也属于 3NF。
- **个人借用器材**

  user_equipment({ 用户ID、器材ID、借用开始时间、借用结束时间、归还状态、借用数量 })

  F={ (用户ID, 器材ID, 借用开始时间、借用结束时间)→(归还状态, 借用数量) }

  个人借用器材表中的主码为用户ID、器材ID、借用开始时间、借用结束时间组成的属性集。对于每个函数依赖，其左部包含码，因此个人借用器材表 ∈ BCNF，个人借用器材表 ∈ 3NF。
- **团体借用器材**

  group_equipment({ 团体ID、器材ID、借用开始时间、借用结束时间、归还状态、借用数量 })

  F={ (团体ID, 器材ID, 借用开始时间, 借用结束时间)→(归还状态, 借用数量) }

  团体借用器材表中的主码为团体ID、器材ID、借用开始时间、借用结束时间组成的属性集。对于每个函数依赖，其左部包含码，因此团体借用器材表 ∈ BCNF，团体借用器材表 ∈ 3NF。
- **用户动态互动记录**

  user_favor_stream({ 用户ID、动态ID })

  F={ (用户ID, 动态ID)→(用户ID, 动态ID) }

  用户动态互动记录表所有属性都是主属性且共同组成主码，因此用户动态互动记录表 ∈ BCNF，用户动态互动记录表 ∈ 3NF。

### 3.3 数据库设计优化

#### 3.3.1 建立索引

建立索引是数据库设计和优化中的重要手段之一，它可以提高数据库的查询性能和数据检索效率。

对于基本的查询，实体表通常以特定的ID作为主键，同时实体在数据库中需要经常做连接操作，因此对主键字段加上索引。在联系表上，除了以多个外键为组合的主键外，通常有根据特定关联实体查询联系的需求。比如查询特定用户参与的团体或活动，需要根据对于联系表关联用户表的字段进行查询，因此为其外键添加索引可以提高查询效率。在数据库设计优化中，最基本的原则就是对表主键和外键加上索引，使得基本的表查询语句效率加快。

其次，实际应用中考虑到需要为用户提供不同需求的查询，比如查询某活动时允许根据活动名称、活动类型、活动标签等字段来挑选符合条件的活动，用户可以根据器材类型等信息对借用记录进行筛选，在处理申请信息时会更在意那些未被处理的申请。类似这些通常会被用于查询的字段也建立索引以提高查询效率。

在该应用中，有很多场景会有根据时间字段的查询，比如查询特定时间的活动、器材借阅记录。此外，在活动创建方面根据实际的应用场景，我们需要在数据库中检索相应的场地使用情况，这些都需要根据时间字段进行查询。为了加快这些功能需求的查询效率，我们为时间字段加上索引。

#### 3.3.2 关系模式优化

删除不必要的1:1联系。比如用户、活动、团体等都和图片表有1:1的联系，在做查询时则需要进行连接。其次对于图片，并无实际需求要对其实体表进行查询，因此可以删除图片表和有关的1:1联系表，将联系转换成对应实体的属性上，可以减少连接操作，加快查询效率。

为实体表添加属性避免过多查询。在团体、活动中查询其成员数量，可以在其联系表中进行计算。然而在查询所有团体、活动的基本信息时，需要对实体表和联系表进行连接，然后分组查询，再进行统计。通过在实体表中加入"成员数量"的属性，可以避免连接操作，又因为活动表比起其成员联系表，数据项大大减少，因此只加入一个属性就可以带来查询效率上的提升，也不会造成数据冗余的问题。

优化联系表的设计。设计场地活动联系表，加上起始时间，结束时间的属性，为检索场地使用情况提供便利。

#### 3.3.3 查询语句优化

查询数据库表的时候，约定通常对已经建立索引的字段进行查询。比如活动表，用户表，团体表等的查询，都对其主键ID进行检索，可以提高查询效率。

对于嵌套查询，尽可能转化成联表查询，可以大大减少查询表的次数。

利用 django 的 ORM 框架对多情景的查询，先确定查询条件在查表。比如在检索活动时，用户可以根据时间，类型，标题等进行个性化的查询操作。如果每次根据是否有对应条件检索表，则需要多次检索。而利用 ORM 框架先确定检索条件再做查询，则可将多次查询优化成一次。

#### 3.3.4 完整性控制

创建数据库表时，严格添加约束，如主键约束、NOTNULL、UNIQUE 等，保证数据完整性，防止数据库中存在不符合语义的数据，防止错误信息的输入和输出。对于外键，设置级联删除，保证数据库的数据一致统一。
